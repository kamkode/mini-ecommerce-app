<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini E-commerce App</title>
    <style>
        :root {
            /* Light theme (default) */
            --primary-color: #f4511e;
            --primary-color-hover: #e04018;
            --background-color: #f8f8f8;
            --card-background: #ffffff;
            --text-color: #333333;
            --text-secondary: #666666;
            --border-color: #eeeeee;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --hover-background: #f9f9f9;
        }

        [data-theme="dark"] {
            /* Dark theme */
            --primary-color: #ff6b45;
            --primary-color-hover: #ff8c6d;
            --background-color: #121212;
            --card-background: #1e1e1e;
            --text-color: #f0f0f0;
            --text-secondary: #aaaaaa;
            --border-color: #333333;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --hover-background: #2a2a2a;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            box-sizing: border-box;
        }

        @media (max-width: 1440px) {
            .container {
                max-width: 1200px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
        }
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s ease;
        }
        .cart-icon {
            position: relative;
            cursor: pointer;
        }
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: white;
            color: var(--primary-color);
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        .products-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        /* Responsive adjustments for different screen sizes */
        @media (max-width: 1200px) {
            .products-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 992px) {
            .products-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .products-grid {
                grid-template-columns: 1fr;
            }
        }
        .product-card {
            background-color: var(--card-background);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px var(--shadow-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
            cursor: pointer;
            height: 100%;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px var(--shadow-color);
        }
        .product-image {
            height: 180px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--hover-background);
            padding: 10px;
            transition: all 0.3s ease;
        }

        @media (max-width: 992px) {
            .product-image {
                height: 160px;
            }
        }
        .product-image img {
            max-height: 100%;
            max-width: 100%;
            object-fit: contain;
        }
        .product-info {
            padding: 12px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .product-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            height: 36px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            text-overflow: ellipsis;
            color: var(--text-color);
            transition: color 0.3s ease;
        }

        @media (max-width: 992px) {
            .product-title {
                font-size: 13px;
                height: 34px;
            }
        }
        .product-price {
            font-size: 16px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 6px;
            transition: color 0.3s ease;
        }

        @media (max-width: 992px) {
            .product-price {
                font-size: 15px;
                margin-bottom: 5px;
            }
        }
        .product-rating {
            display: flex;
            align-items: center;
        }
        .stars {
            color: #FFD700;
            margin-right: 5px;
            font-size: 14px;
        }

        @media (max-width: 992px) {
            .stars {
                font-size: 12px;
            }
        }
        .rating-text {
            font-size: 12px;
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }

        @media (max-width: 992px) {
            .rating-text {
                font-size: 11px;
            }
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
            font-size: 18px;
        }
        .error {
            color: red;
            text-align: center;
            margin-top: 20px;
        }
        .product-detail {
            display: none;
            background-color: var(--card-background);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 5px var(--shadow-color);
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .detail-image {
            text-align: center;
            margin-bottom: 20px;
        }
        .detail-image img {
            max-height: 300px;
            max-width: 100%;
        }
        .detail-info h2 {
            margin-top: 0;
        }
        .detail-price {
            font-size: 24px;
            font-weight: bold;
            color: #f4511e;
            margin: 10px 0;
        }
        .detail-description {
            line-height: 1.6;
            color: var(--text-color);
            margin-bottom: 20px;
        }

        /* Reviews Section Styles */
        .reviews-section, .related-products-section {
            margin-top: 30px;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }

        .reviews-section h3, .related-products-section h3 {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--text-color);
        }

        .reviews-container {
            margin-bottom: 25px;
        }

        .review-item {
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .review-author {
            font-weight: bold;
            color: var(--text-color);
        }

        .review-date {
            color: var(--text-secondary);
            font-size: 12px;
        }

        .review-rating {
            color: #FFD700;
            margin-bottom: 8px;
        }

        .review-text {
            color: var(--text-color);
            line-height: 1.5;
        }

        .add-review h4 {
            font-size: 16px;
            margin-bottom: 12px;
            color: var(--text-color);
        }

        .rating-input {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .rating-input span {
            margin-right: 10px;
            color: var(--text-color);
        }

        .star-rating {
            display: flex;
            cursor: pointer;
        }

        .star-rating i {
            color: #FFD700;
            margin-right: 5px;
            font-size: 20px;
            transition: all 0.2s ease;
        }

        .star-rating i:hover {
            transform: scale(1.2);
        }

        #review-text {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 12px;
            resize: vertical;
            background-color: var(--card-background);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        #review-text:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .submit-review-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .submit-review-btn:hover {
            background-color: var(--primary-color-hover);
        }

        /* Related Products Styles */
        .related-products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .related-product-card {
            background-color: var(--card-background);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px var(--shadow-color);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .related-product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px var(--shadow-color);
        }

        .related-product-image {
            height: 150px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--hover-background);
            padding: 10px;
        }

        .related-product-image img {
            max-height: 100%;
            max-width: 100%;
            object-fit: contain;
        }

        .related-product-info {
            padding: 10px;
        }

        .related-product-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
            height: 36px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            text-overflow: ellipsis;
            color: var(--text-color);
        }

        .related-product-price {
            font-size: 16px;
            font-weight: bold;
            color: var(--primary-color);
        }

        /* Recently Viewed Products Styles */
        .recently-viewed-section {
            margin-top: 30px;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }

        .recently-viewed-section h3 {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--text-color);
        }

        .recently-viewed-products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .recently-viewed-card {
            background-color: var(--card-background);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px var(--shadow-color);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .recently-viewed-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px var(--shadow-color);
        }

        .recently-viewed-image {
            height: 150px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--hover-background);
            padding: 10px;
        }

        .recently-viewed-image img {
            max-height: 100%;
            max-width: 100%;
            object-fit: contain;
        }

        .recently-viewed-info {
            padding: 10px;
        }

        .recently-viewed-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
            height: 36px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            text-overflow: ellipsis;
            color: var(--text-color);
        }

        .recently-viewed-price {
            font-size: 16px;
            font-weight: bold;
            color: var(--primary-color);
        }
        .add-to-cart-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .add-to-cart-btn:hover {
            background-color: var(--primary-color-hover);
        }
        .cart-container {
            display: none;
            background-color: var(--card-background);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 5px var(--shadow-color);
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .cart-item {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            padding: 15px 0;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .cart-item:hover {
            background-color: var(--hover-background);
            border-radius: 8px;
            padding: 15px 10px;
        }
        .cart-item-image {
            width: 80px;
            height: 80px;
            margin-right: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            background-color: var(--hover-background);
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }
        .cart-item-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .cart-item-info {
            flex: 1;
        }
        .cart-item-title {
            font-weight: 500;
            margin-bottom: 5px;
        }
        .cart-item-price {
            color: #f4511e;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .cart-item-quantity {
            display: flex;
            align-items: center;
        }
        .quantity-btn {
            background-color: #f4511e;
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            font-size: 14px;
            cursor: pointer;
        }
        .quantity-value {
            margin: 0 10px;
            font-weight: 500;
        }
        .cart-summary {
            margin-top: 20px;
            text-align: right;
        }
        .cart-total {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .cart-buttons {
            display: flex;
            justify-content: flex-end;
        }
        .clear-cart-btn {
            background-color: white;
            color: #f4511e;
            border: 1px solid #f4511e;
            padding: 10px 15px;
            border-radius: 4px;
            margin-right: 10px;
            cursor: pointer;
        }
        .checkout-btn {
            background-color: #f4511e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
        }
        .empty-cart {
            text-align: center;
            padding: 40px 0;
        }
        .empty-cart i {
            font-size: 48px;
            color: #ddd;
            margin-bottom: 15px;
        }
        .empty-cart p {
            font-size: 18px;
            color: #666;
            margin-bottom: 20px;
        }
        .shop-now-btn {
            background-color: #f4511e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
        }
        .title-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        .wishlist-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid #f4511e;
            background-color: white;
            color: #f4511e;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 18px;
            margin-left: 10px;
        }
        .wishlist-btn.active {
            background-color: #f4511e;
            color: white;
        }
        .button-row {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        .secondary-btn {
            flex: 1;
            background-color: white;
            color: #f4511e;
            border: 1px solid #f4511e;
            padding: 10px 15px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 5px;
        }

        /* Pagination styles */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px 0 15px;
            flex-wrap: wrap;
        }

        .pagination-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid #ddd;
            background-color: white;
            color: #333;
            font-weight: 500;
            margin: 0 5px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s ease;
        }

        .pagination-btn:hover {
            border-color: #f4511e;
            color: #f4511e;
        }

        .pagination-btn.active {
            background-color: #f4511e;
            color: white;
            border-color: #f4511e;
        }

        .pagination-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 480px) {
            .pagination-btn {
                width: 35px;
                height: 35px;
                margin: 0 3px;
                font-size: 14px;
            }

            .pagination {
                margin: 20px 0 10px;
            }
        }
        .wishlist-container {
            background-color: var(--card-background);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 5px var(--shadow-color);
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .cart-item-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        .add-to-cart-small {
            background-color: #f4511e;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        .remove-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid #f4511e;
            background-color: white;
            color: #f4511e;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        .back-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            cursor: pointer;
            display: inline-block;
            transition: background-color 0.3s ease;
        }

        .back-btn:hover {
            background-color: var(--primary-color-hover);
        }

        /* Search and Filter Styles */
        .search-filter-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-container {
            display: flex;
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            background-color: var(--card-background);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(244, 81, 30, 0.2);
        }

        .search-btn {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            padding: 0 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-top-right-radius: 4px;
            border-bottom-right-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .search-btn:hover {
            background-color: var(--primary-color-hover);
        }

        .filter-container {
            min-width: 200px;
        }

        .category-filter {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--card-background);
            color: var(--text-color);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-filter:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .search-filter-container {
                flex-direction: column;
                align-items: stretch;
            }

            .search-container, .filter-container {
                width: 100%;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <header>
        <h1>Mini E-commerce</h1>
        <div style="display: flex; align-items: center;">
            <div class="theme-toggle" onclick="toggleTheme()" style="margin-right: 15px; cursor: pointer;">
                <i class="fas fa-moon fa-lg" id="theme-icon"></i>
            </div>
            <div class="sort-icon" onclick="toggleSortOptions()" style="margin-right: 15px; cursor: pointer;">
                <i class="fas fa-sort fa-lg"></i>
            </div>
            <div class="wishlist-icon" onclick="showWishlist()" style="margin-right: 15px; cursor: pointer; position: relative;">
                <i class="far fa-heart fa-lg"></i>
                <div class="cart-badge" id="wishlist-badge" style="display: none;">0</div>
            </div>
            <div class="cart-icon" onclick="showCart()">
                <i class="fas fa-shopping-cart fa-lg"></i>
                <div class="cart-badge" id="cart-badge">0</div>
            </div>
        </div>
    </header>

    <!-- Sort Options Dropdown -->
    <div id="sort-options" style="display: none; position: absolute; right: 60px; top: 60px; background: var(--card-background); border: 1px solid var(--border-color); border-radius: 5px; box-shadow: 0 2px 5px var(--shadow-color); z-index: 100; transition: background-color 0.3s ease, border-color 0.3s ease;">
        <div style="padding: 10px; border-bottom: 1px solid var(--border-color); font-weight: bold; color: var(--text-color);">Sort By</div>
        <div class="sort-option" onclick="sortProducts('price-low-high')" style="padding: 10px; cursor: pointer; border-bottom: 1px solid var(--border-color); color: var(--text-color);">Price: Low to High</div>
        <div class="sort-option" onclick="sortProducts('price-high-low')" style="padding: 10px; cursor: pointer; border-bottom: 1px solid var(--border-color); color: var(--text-color);">Price: High to Low</div>
        <div class="sort-option" onclick="sortProducts('rating')" style="padding: 10px; cursor: pointer; border-bottom: 1px solid var(--border-color); color: var(--text-color);">Highest Rated</div>
        <div class="sort-option" onclick="sortProducts(null)" style="padding: 10px; cursor: pointer; color: var(--text-color);">Default</div>
    </div>

    <div class="container">
        <div id="products-container">
            <!-- Search and Filter Bar -->
            <div class="search-filter-container">
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Search products..." class="search-input">
                    <button class="search-btn" onclick="searchProducts()"><i class="fas fa-search"></i></button>
                </div>
                <div class="filter-container">
                    <select id="category-filter" class="category-filter" onchange="filterByCategory(this.value)">
                        <option value="all">All Categories</option>
                        <!-- Categories will be populated dynamically -->
                    </select>
                </div>
            </div>

            <div class="loading" id="loading">
                <p>Loading products...</p>
            </div>
            <div class="error" id="error" style="display: none;"></div>
            <div class="products-grid" id="products-grid"></div>
            <div class="pagination" id="pagination"></div>

            <!-- Recently Viewed Products -->
            <div class="recently-viewed-section" id="recently-viewed-section" style="display: none;">
                <h3>Recently Viewed</h3>
                <div class="recently-viewed-products" id="recently-viewed-products">
                    <!-- Recently viewed products will be populated here -->
                </div>
            </div>
        </div>

        <div class="product-detail" id="product-detail">
            <button class="back-btn" onclick="showProducts()"><i class="fas fa-arrow-left"></i> Back to Products</button>
            <div class="detail-image" id="detail-image"></div>
            <div class="detail-info" id="detail-info"></div>

            <!-- Reviews Section -->
            <div class="reviews-section" id="reviews-section">
                <h3>Customer Reviews</h3>
                <div class="reviews-container" id="reviews-container">
                    <!-- Reviews will be populated here -->
                </div>
                <div class="add-review">
                    <h4>Add Your Review</h4>
                    <div class="rating-input">
                        <span>Your Rating:</span>
                        <div class="star-rating">
                            <i class="far fa-star" data-rating="1"></i>
                            <i class="far fa-star" data-rating="2"></i>
                            <i class="far fa-star" data-rating="3"></i>
                            <i class="far fa-star" data-rating="4"></i>
                            <i class="far fa-star" data-rating="5"></i>
                        </div>
                    </div>
                    <textarea id="review-text" placeholder="Write your review here..."></textarea>
                    <button class="submit-review-btn" onclick="submitReview()">Submit Review</button>
                </div>
            </div>

            <!-- Related Products Section -->
            <div class="related-products-section">
                <h3>Related Products</h3>
                <div class="related-products" id="related-products">
                    <!-- Related products will be populated here -->
                </div>
            </div>
        </div>

        <div class="cart-container" id="cart-container"></div>

        <div class="wishlist-container" id="wishlist-container" style="display: none;">
            <button class="back-btn" onclick="showProducts()"><i class="fas fa-arrow-left"></i> Back to Products</button>
            <h2>My Wishlist</h2>
            <div id="wishlist-items"></div>
        </div>
    </div>

    <script>
        // Global variables
        let products = [];
        let originalProducts = [];
        let cart = [];
        let wishlist = [];
        let currentProduct = null;
        let currentSortOption = null;
        let currentPage = 1;
        let productsPerPage = 10; // Show 10 products per page
        let currentTheme = localStorage.getItem('theme') || 'light';
        let categories = [];
        let recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed')) || [];
        let reviews = JSON.parse(localStorage.getItem('productReviews')) || {};
        let currentRating = 0;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            loadCart();
            loadWishlist();
            fetchProducts();
            applyTheme();
        });

        // Toggle between light and dark theme
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme();
            localStorage.setItem('theme', currentTheme);
        }

        // Apply the current theme
        function applyTheme() {
            const themeIcon = document.getElementById('theme-icon');

            if (currentTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            } else {
                document.documentElement.removeAttribute('data-theme');
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
            }
        }

        // Fetch products from API
        async function fetchProducts() {
            try {
                const response = await fetch('https://fakestoreapi.com/products');
                if (!response.ok) {
                    throw new Error('Failed to fetch products');
                }
                const data = await response.json();
                products = [...data];
                originalProducts = [...data];

                // Extract unique categories
                const uniqueCategories = [...new Set(data.map(product => product.category))];
                categories = uniqueCategories;

                // Populate category filter
                populateCategoryFilter(uniqueCategories);

                // Display products
                displayProducts();

                // Display recently viewed products if any
                displayRecentlyViewed();
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = error.message;
            }
        }

        // Populate category filter dropdown
        function populateCategoryFilter(categories) {
            const categoryFilter = document.getElementById('category-filter');

            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                categoryFilter.appendChild(option);
            });
        }

        // Filter products by category
        function filterByCategory(category) {
            currentPage = 1; // Reset to first page

            if (category === 'all') {
                products = [...originalProducts];
            } else {
                products = originalProducts.filter(product => product.category === category);
            }

            // Apply current sort if any
            if (currentSortOption) {
                sortProducts(currentSortOption, false);
            } else {
                displayProducts();
            }
        }

        // Search products
        function searchProducts() {
            const searchInput = document.getElementById('search-input').value.toLowerCase().trim();
            currentPage = 1; // Reset to first page

            if (searchInput === '') {
                // If search is empty, reset to original products or current category filter
                const categoryFilter = document.getElementById('category-filter');
                filterByCategory(categoryFilter.value);
                return;
            }

            // Filter products based on search term
            products = originalProducts.filter(product => {
                return (
                    product.title.toLowerCase().includes(searchInput) ||
                    product.description.toLowerCase().includes(searchInput) ||
                    product.category.toLowerCase().includes(searchInput)
                );
            });

            displayProducts();
        }

        // Add product to recently viewed
        function addToRecentlyViewed(product) {
            // Remove the product if it's already in the list
            const existingIndex = recentlyViewed.findIndex(item => item.id === product.id);
            if (existingIndex !== -1) {
                recentlyViewed.splice(existingIndex, 1);
            }

            // Add to the beginning of the array
            recentlyViewed.unshift(product);

            // Keep only the last 6 items
            if (recentlyViewed.length > 6) {
                recentlyViewed = recentlyViewed.slice(0, 6);
            }

            // Save to localStorage
            localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed));

            // Update the display
            displayRecentlyViewed();
        }

        // Display recently viewed products
        function displayRecentlyViewed() {
            const recentlyViewedSection = document.getElementById('recently-viewed-section');
            const recentlyViewedContainer = document.getElementById('recently-viewed-products');

            if (recentlyViewed.length === 0) {
                recentlyViewedSection.style.display = 'none';
                return;
            }

            recentlyViewedSection.style.display = 'block';
            recentlyViewedContainer.innerHTML = '';

            recentlyViewed.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'recently-viewed-card';
                productCard.onclick = () => showProductDetail(product);

                productCard.innerHTML = `
                    <div class="recently-viewed-image">
                        <img src="${product.image}" alt="${product.title}">
                    </div>
                    <div class="recently-viewed-info">
                        <div class="recently-viewed-title">${product.title}</div>
                        <div class="recently-viewed-price">$${product.price.toFixed(2)}</div>
                    </div>
                `;

                recentlyViewedContainer.appendChild(productCard);
            });
        }

        // Display products in grid with pagination
        function displayProducts() {
            const productsGrid = document.getElementById('products-grid');
            const paginationContainer = document.getElementById('pagination');
            document.getElementById('loading').style.display = 'none';

            productsGrid.innerHTML = '';

            // Calculate pagination
            const totalPages = Math.ceil(products.length / productsPerPage);
            const startIndex = (currentPage - 1) * productsPerPage;
            const endIndex = Math.min(startIndex + productsPerPage, products.length);

            // Display only products for current page
            for (let i = startIndex; i < endIndex; i++) {
                const product = products[i];
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.onclick = () => showProductDetail(product);

                productCard.innerHTML = `
                    <div class="product-image">
                        <img src="${product.image}" alt="${product.title}">
                    </div>
                    <div class="product-info">
                        <div>
                            <div class="product-title">${product.title}</div>
                            <div class="product-price">$${product.price.toFixed(2)}</div>
                        </div>
                        <div class="product-rating">
                            <div class="stars">${getStars(product.rating.rate)}</div>
                            <div class="rating-text">${product.rating.rate.toFixed(1)} (${product.rating.count})</div>
                        </div>
                    </div>
                `;

                productsGrid.appendChild(productCard);
            }

            // Generate pagination controls
            renderPagination(totalPages);
        }

        // Generate star rating HTML
        function getStars(rating) {
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);

            let starsHTML = '';

            for (let i = 0; i < fullStars; i++) {
                starsHTML += '<i class="fas fa-star"></i>';
            }

            if (halfStar) {
                starsHTML += '<i class="fas fa-star-half-alt"></i>';
            }

            for (let i = 0; i < emptyStars; i++) {
                starsHTML += '<i class="far fa-star"></i>';
            }

            return starsHTML;
        }

        // Show product detail
        function showProductDetail(product) {
            currentProduct = product;

            // Add to recently viewed
            addToRecentlyViewed(product);

            document.getElementById('products-container').style.display = 'none';
            document.getElementById('cart-container').style.display = 'none';
            document.getElementById('product-detail').style.display = 'block';

            const detailImage = document.getElementById('detail-image');
            const detailInfo = document.getElementById('detail-info');

            detailImage.innerHTML = `<img src="${product.image}" alt="${product.title}">`;

            const productInCart = cart.find(item => item.id === product.id);
            const cartQuantity = productInCart ? productInCart.quantity : 0;
            const productInWishlist = isInWishlist(product.id);

            detailInfo.innerHTML = `
                <div class="title-row">
                    <h2>${product.title}</h2>
                    <button class="wishlist-btn ${productInWishlist ? 'active' : ''}" onclick="toggleWishlist(currentProduct)">
                        <i class="${productInWishlist ? 'fas' : 'far'} fa-heart"></i>
                    </button>
                </div>
                <div class="detail-price">$${product.price.toFixed(2)}</div>
                <div class="product-rating">
                    <div class="stars">${getStars(product.rating.rate)}</div>
                    <div class="rating-text">${product.rating.rate.toFixed(1)} (${product.rating.count} reviews)</div>
                </div>
                <p class="detail-description">${product.description}</p>
                <button class="add-to-cart-btn" onclick="addToCart(currentProduct)">
                    ${cartQuantity > 0 ? `Add More (${cartQuantity} in cart)` : 'Add to Cart'}
                </button>
                <div class="button-row">
                    ${cartQuantity > 0 ? '<button class="secondary-btn" onclick="showCart()">View Cart</button>' : ''}
                    ${productInWishlist ? '<button class="secondary-btn" onclick="showWishlist()">View Wishlist</button>' : ''}
                </div>
            `;

            // Display reviews
            displayReviews(product.id);

            // Setup star rating functionality
            setupStarRating();

            // Display related products
            displayRelatedProducts(product);
        }

        // Display reviews for a product
        function displayReviews(productId) {
            const reviewsContainer = document.getElementById('reviews-container');
            reviewsContainer.innerHTML = '';

            const productReviews = reviews[productId] || [];

            if (productReviews.length === 0) {
                reviewsContainer.innerHTML = '<p>No reviews yet. Be the first to review this product!</p>';
                return;
            }

            productReviews.forEach(review => {
                const reviewItem = document.createElement('div');
                reviewItem.className = 'review-item';

                reviewItem.innerHTML = `
                    <div class="review-header">
                        <div class="review-author">${review.author}</div>
                        <div class="review-date">${review.date}</div>
                    </div>
                    <div class="review-rating">${getStars(review.rating)}</div>
                    <div class="review-text">${review.text}</div>
                `;

                reviewsContainer.appendChild(reviewItem);
            });
        }

        // Setup star rating functionality
        function setupStarRating() {
            const stars = document.querySelectorAll('.star-rating i');

            stars.forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.getAttribute('data-rating'));
                    currentRating = rating;

                    // Update UI
                    stars.forEach(s => {
                        const starRating = parseInt(s.getAttribute('data-rating'));
                        if (starRating <= rating) {
                            s.className = 'fas fa-star';
                        } else {
                            s.className = 'far fa-star';
                        }
                    });
                });
            });
        }

        // Submit a review
        function submitReview() {
            if (!currentProduct) return;

            const reviewText = document.getElementById('review-text').value.trim();

            if (currentRating === 0) {
                alert('Please select a rating');
                return;
            }

            if (reviewText === '') {
                alert('Please write a review');
                return;
            }

            // Create review object
            const review = {
                productId: currentProduct.id,
                author: 'Anonymous User', // In a real app, this would be the user's name
                rating: currentRating,
                text: reviewText,
                date: new Date().toLocaleDateString()
            };

            // Add to reviews
            if (!reviews[currentProduct.id]) {
                reviews[currentProduct.id] = [];
            }

            reviews[currentProduct.id].unshift(review);

            // Save to localStorage
            localStorage.setItem('productReviews', JSON.stringify(reviews));

            // Reset form
            document.getElementById('review-text').value = '';
            const stars = document.querySelectorAll('.star-rating i');
            stars.forEach(star => {
                star.className = 'far fa-star';
            });
            currentRating = 0;

            // Update display
            displayReviews(currentProduct.id);

            // Show confirmation
            alert('Thank you for your review!');
        }

        // Display related products
        function displayRelatedProducts(product) {
            const relatedProductsContainer = document.getElementById('related-products');
            relatedProductsContainer.innerHTML = '';

            // Find products in the same category
            const relatedProducts = originalProducts.filter(p =>
                p.category === product.category && p.id !== product.id
            ).slice(0, 4); // Show up to 4 related products

            if (relatedProducts.length === 0) {
                relatedProductsContainer.innerHTML = '<p>No related products found.</p>';
                return;
            }

            relatedProducts.forEach(relatedProduct => {
                const productCard = document.createElement('div');
                productCard.className = 'related-product-card';
                productCard.onclick = () => showProductDetail(relatedProduct);

                productCard.innerHTML = `
                    <div class="related-product-image">
                        <img src="${relatedProduct.image}" alt="${relatedProduct.title}">
                    </div>
                    <div class="related-product-info">
                        <div class="related-product-title">${relatedProduct.title}</div>
                        <div class="related-product-price">$${relatedProduct.price.toFixed(2)}</div>
                    </div>
                `;

                relatedProductsContainer.appendChild(productCard);
            });
        }

        // Toggle sort options dropdown
        function toggleSortOptions() {
            const sortOptions = document.getElementById('sort-options');
            if (sortOptions.style.display === 'none') {
                sortOptions.style.display = 'block';
                // Close dropdown when clicking outside
                document.addEventListener('click', closeSortOptionsOnClickOutside);
            } else {
                sortOptions.style.display = 'none';
                document.removeEventListener('click', closeSortOptionsOnClickOutside);
            }
        }

        // Close sort options when clicking outside
        function closeSortOptionsOnClickOutside(event) {
            const sortOptions = document.getElementById('sort-options');
            const sortIcon = document.querySelector('.sort-icon');

            if (!sortOptions.contains(event.target) && !sortIcon.contains(event.target)) {
                sortOptions.style.display = 'none';
                document.removeEventListener('click', closeSortOptionsOnClickOutside);
            }
        }

        // Render pagination controls
        function renderPagination(totalPages) {
            const paginationContainer = document.getElementById('pagination');
            paginationContainer.innerHTML = '';

            if (totalPages <= 1) {
                return; // Don't show pagination if there's only one page
            }

            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = `pagination-btn ${currentPage === 1 ? 'disabled' : ''}`;
            prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevBtn.disabled = currentPage === 1;
            prevBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    displayProducts();
                    window.scrollTo(0, 0);
                }
            });
            paginationContainer.appendChild(prevBtn);

            // Page buttons
            const maxVisiblePages = window.innerWidth < 768 ? 3 : 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

            // Adjust if we're near the end
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }

            // First page button if not visible
            if (startPage > 1) {
                const firstPageBtn = document.createElement('button');
                firstPageBtn.className = 'pagination-btn';
                firstPageBtn.textContent = '1';
                firstPageBtn.addEventListener('click', () => {
                    currentPage = 1;
                    displayProducts();
                    window.scrollTo(0, 0);
                });
                paginationContainer.appendChild(firstPageBtn);

                // Ellipsis if needed
                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.margin = '0 5px';
                    paginationContainer.appendChild(ellipsis);
                }
            }

            // Page buttons
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    currentPage = i;
                    displayProducts();
                    window.scrollTo(0, 0);
                });
                paginationContainer.appendChild(pageBtn);
            }

            // Last page button if not visible
            if (endPage < totalPages) {
                // Ellipsis if needed
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.margin = '0 5px';
                    paginationContainer.appendChild(ellipsis);
                }

                const lastPageBtn = document.createElement('button');
                lastPageBtn.className = 'pagination-btn';
                lastPageBtn.textContent = totalPages;
                lastPageBtn.addEventListener('click', () => {
                    currentPage = totalPages;
                    displayProducts();
                    window.scrollTo(0, 0);
                });
                paginationContainer.appendChild(lastPageBtn);
            }

            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.className = `pagination-btn ${currentPage === totalPages ? 'disabled' : ''}`;
            nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    displayProducts();
                    window.scrollTo(0, 0);
                }
            });
            paginationContainer.appendChild(nextBtn);
        }

        // Sort products
        function sortProducts(option, closeDropdown = true) {
            currentSortOption = option;
            let sortedProducts = [...products];

            switch (option) {
                case 'price-low-high':
                    sortedProducts.sort((a, b) => a.price - b.price);
                    break;
                case 'price-high-low':
                    sortedProducts.sort((a, b) => b.price - a.price);
                    break;
                case 'rating':
                    sortedProducts.sort((a, b) => b.rating.rate - a.rating.rate);
                    break;
                default:
                    // If we're filtering by category, don't reset to original products
                    if (document.getElementById('category-filter').value === 'all' && !document.getElementById('search-input').value.trim()) {
                        sortedProducts = [...originalProducts];
                    }
                    currentSortOption = null;
            }

            products = sortedProducts;
            currentPage = 1; // Reset to first page when sorting
            displayProducts();

            // Close the sort options dropdown if needed
            if (closeDropdown) {
                document.getElementById('sort-options').style.display = 'none';
                document.removeEventListener('click', closeSortOptionsOnClickOutside);
            }
        }

        // Show products grid
        function showProducts() {
            document.getElementById('products-container').style.display = 'block';
            document.getElementById('product-detail').style.display = 'none';
            document.getElementById('cart-container').style.display = 'none';
            document.getElementById('wishlist-container').style.display = 'none';
        }

        // Show cart
        function showCart() {
            document.getElementById('products-container').style.display = 'none';
            document.getElementById('product-detail').style.display = 'none';
            document.getElementById('cart-container').style.display = 'block';
            document.getElementById('wishlist-container').style.display = 'none';

            renderCart();
        }

        // Show wishlist
        function showWishlist() {
            document.getElementById('products-container').style.display = 'none';
            document.getElementById('product-detail').style.display = 'none';
            document.getElementById('cart-container').style.display = 'none';
            document.getElementById('wishlist-container').style.display = 'block';

            renderWishlist();
        }

        // Render wishlist
        function renderWishlist() {
            const wishlistItems = document.getElementById('wishlist-items');

            if (wishlist.length === 0) {
                wishlistItems.innerHTML = `
                    <div class="empty-cart">
                        <i class="far fa-heart fa-3x"></i>
                        <p>Your wishlist is empty</p>
                        <button class="shop-now-btn" onclick="showProducts()">Start Shopping</button>
                    </div>
                `;
                return;
            }

            let wishlistHTML = '';

            wishlist.forEach(item => {
                const inCart = cart.find(cartItem => cartItem.id === item.id);

                wishlistHTML += `
                    <div class="cart-item">
                        <div class="cart-item-image" onclick="showProductDetailById(${item.id})">
                            <img src="${item.image}" alt="${item.title}">
                        </div>
                        <div class="cart-item-info">
                            <div class="cart-item-title" onclick="showProductDetailById(${item.id})">                                ${item.title}
                            </div>
                            <div class="cart-item-price">$${item.price.toFixed(2)}</div>
                            <div class="cart-item-actions">
                                <button class="add-to-cart-small" onclick="addToCartById(${item.id}); renderWishlist();">
                                    ${inCart ? 'Add More to Cart' : 'Add to Cart'}
                                </button>
                                <button class="remove-btn" onclick="removeFromWishlistById(${item.id}); renderWishlist();">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });

            wishlistItems.innerHTML = wishlistHTML;
        }

        // Add product to cart
        function addToCart(product) {
            const existingItem = cart.find(item => item.id === product.id);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    ...product,
                    quantity: 1
                });
            }

            // If the product is in the wishlist, remove it
            if (isInWishlist(product.id)) {
                removeFromWishlist(product);
            }

            saveCart();
            updateCartBadge();

            // Update the Add to Cart button text
            if (currentProduct && currentProduct.id === product.id) {
                const addToCartBtn = document.querySelector('.add-to-cart-btn');
                const productInCart = cart.find(item => item.id === product.id);
                const cartQuantity = productInCart ? productInCart.quantity : 0;

                addToCartBtn.textContent = `Add More (${cartQuantity} in cart)`;

                // Add View Cart button if not already present
                if (!document.querySelector('.clear-cart-btn')) {
                    const viewCartBtn = document.createElement('button');
                    viewCartBtn.className = 'clear-cart-btn';
                    viewCartBtn.textContent = 'View Cart';
                    viewCartBtn.onclick = showCart;
                    addToCartBtn.parentNode.appendChild(viewCartBtn);
                }
            }
        }

        // Remove item from cart
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            saveCart();
            updateCartBadge();
            renderCart();
        }

        // Update item quantity
        function updateQuantity(productId, newQuantity) {
            if (newQuantity <= 0) {
                removeFromCart(productId);
                return;
            }

            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity = newQuantity;
                saveCart();
                updateCartBadge();
                renderCart();
            }
        }

        // Render cart contents
        function renderCart() {
            const cartContainer = document.getElementById('cart-container');

            if (cart.length === 0) {
                cartContainer.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-shopping-cart"></i>
                        <p>Your cart is empty</p>
                        <button class="shop-now-btn" onclick="showProducts()">Start Shopping</button>
                    </div>
                `;
                return;
            }

            let cartHTML = `
                <button class="back-btn" onclick="showProducts()"><i class="fas fa-arrow-left"></i> Back to Products</button>
                <h2>Shopping Cart</h2>
            `;

            cart.forEach(item => {
                cartHTML += `
                    <div class="cart-item">
                        <div class="cart-item-image">
                            <img src="${item.image}" alt="${item.title}">
                        </div>
                        <div class="cart-item-info">
                            <div class="cart-item-title">${item.title}</div>
                            <div class="cart-item-price">$${item.price.toFixed(2)}</div>
                            <div class="cart-item-quantity">
                                <button class="quantity-btn" onclick="updateQuantity(${item.id}, ${item.quantity - 1})">-</button>
                                <span class="quantity-value">${item.quantity}</span>
                                <button class="quantity-btn" onclick="updateQuantity(${item.id}, ${item.quantity + 1})">+</button>
                            </div>
                        </div>
                        <button class="quantity-btn" onclick="removeFromCart(${item.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
            });

            const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);

            cartHTML += `
                <div class="cart-summary">
                    <div class="cart-total">Total: $${total.toFixed(2)}</div>
                    <div class="cart-buttons">
                        <button class="clear-cart-btn" onclick="clearCart()">Clear Cart</button>
                        <button class="checkout-btn" onclick="checkout()">Checkout</button>
                    </div>
                </div>
            `;

            cartContainer.innerHTML = cartHTML;
        }

        // Clear cart
        function clearCart() {
            if (confirm('Are you sure you want to clear your cart?')) {
                cart = [];
                saveCart();
                updateCartBadge();
                renderCart();
            }
        }

        // Checkout
        function checkout() {
            alert('This is a demo app. No actual purchase will be made.');
            cart = [];
            saveCart();
            updateCartBadge();
            showProducts();
        }

        // Add to wishlist
        function addToWishlist(product) {
            // Check if product is already in wishlist
            const existingItem = wishlist.find(item => item.id === product.id);
            if (!existingItem) {
                wishlist.push(product);
                saveWishlist();
                updateWishlistBadge();

                // Update UI if on product detail page
                if (currentProduct && currentProduct.id === product.id) {
                    updateProductDetailWishlistUI(true);
                }
            }
        }

        // Remove from wishlist
        function removeFromWishlist(product) {
            wishlist = wishlist.filter(item => item.id !== product.id);
            saveWishlist();
            updateWishlistBadge();

            // Update UI if on product detail page
            if (currentProduct && currentProduct.id === product.id) {
                updateProductDetailWishlistUI(false);
            }
        }

        // Check if product is in wishlist
        function isInWishlist(productId) {
            return wishlist.some(item => item.id === productId);
        }

        // Add to cart by ID
        function addToCartById(productId) {
            const product = findProductById(productId);
            if (product) {
                addToCart(product);
                // Also remove from wishlist when added to cart
                removeFromWishlistById(productId);
            }
        }

        // Remove from wishlist by ID
        function removeFromWishlistById(productId) {
            const product = findProductById(productId);
            if (product) {
                removeFromWishlist(product);
            }
        }

        // Show product detail by ID
        function showProductDetailById(productId) {
            const product = findProductById(productId);
            if (product) {
                showProductDetail(product);
            }
        }

        // Find product by ID (from wishlist, cart, or products array)
        function findProductById(productId) {
            // First check wishlist
            let product = wishlist.find(item => item.id === productId);
            if (product) return product;

            // Then check cart
            product = cart.find(item => item.id === productId);
            if (product) return product;

            // Finally check products array
            product = products.find(item => item.id === productId);
            if (product) return product;

            return null;
        }

        // Update product detail wishlist UI
        function updateProductDetailWishlistUI(inWishlist) {
            const wishlistBtn = document.querySelector('.wishlist-btn');
            if (wishlistBtn) {
                if (inWishlist) {
                    wishlistBtn.innerHTML = '<i class="fas fa-heart"></i>';
                    wishlistBtn.classList.add('active');
                } else {
                    wishlistBtn.innerHTML = '<i class="far fa-heart"></i>';
                    wishlistBtn.classList.remove('active');
                }
            }
        }

        // Toggle wishlist
        function toggleWishlist(product) {
            if (isInWishlist(product.id)) {
                removeFromWishlist(product);
            } else {
                addToWishlist(product);
            }
        }

        // Save cart to localStorage
        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        // Load cart from localStorage
        function loadCart() {
            const savedCart = localStorage.getItem('cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
                updateCartBadge();
            }
        }

        // Save wishlist to localStorage
        function saveWishlist() {
            localStorage.setItem('wishlist', JSON.stringify(wishlist));
        }

        // Load wishlist from localStorage
        function loadWishlist() {
            const savedWishlist = localStorage.getItem('wishlist');
            if (savedWishlist) {
                wishlist = JSON.parse(savedWishlist);
                updateWishlistBadge();
            }
        }

        // Update cart badge
        function updateCartBadge() {
            const cartBadge = document.getElementById('cart-badge');
            const itemCount = cart.reduce((total, item) => total + item.quantity, 0);
            cartBadge.textContent = itemCount;
        }

        // Update wishlist badge
        function updateWishlistBadge() {
            const wishlistBadge = document.getElementById('wishlist-badge');
            const itemCount = wishlist.length;

            if (itemCount > 0) {
                wishlistBadge.textContent = itemCount;
                wishlistBadge.style.display = 'flex';
            } else {
                wishlistBadge.style.display = 'none';
            }
        }
    </script>
</body>
</html>
